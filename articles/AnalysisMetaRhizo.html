<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Detection of metagenomic-genomic interactions in Medicago truncatula (MetaRhizo INRAE project) • sicomore</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Detection of metagenomic-genomic interactions in Medicago truncatula (MetaRhizo INRAE project)">
<meta property="og:description" content="sicomore">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sicomore</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.2-9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a>
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/singleData.html">Analysis of a single data set</a>
    </li>
    <li>
      <a href="../articles/twoDataInteraction.html">Analysis of two interacting data sets</a>
    </li>
    <li>
      <a href="../articles/twoDataInteraction.html">Analysis of the MEtaRhizosphere data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/fguinot/sicomore-pkg">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Detection of metagenomic-genomic interactions in Medicago truncatula (MetaRhizo INRAE project)</h1>
                        <h4 class="author">SICoMORe team (F. Guinot, J. Chiquet, M. Szafranski, C. Ambroise)</h4>
            
            <h4 class="date">2020-04-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jchiquet/sicomore-pkg/blob/master/vignettes/AnalysisMetaRhizo.Rmd"><code>vignettes/AnalysisMetaRhizo.Rmd</code></a></small>
      <div class="hidden name"><code>AnalysisMetaRhizo.Rmd</code></div>

    </div>

    
    
<div id="load-database-and-libraries" class="section level2">
<h2 class="hasAnchor">
<a href="#load-database-and-libraries" class="anchor"></a>Load database and libraries</h2>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">sicomore</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">knitr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">repmis</span>)</pre></body></html></div>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co">## Load database from github repository with repmis library</span>
<span class="no">githubURL</span> <span class="kw">&lt;-</span> <span class="st">"https://github.com/fguinot/MetaRhizo-database/blob/master/rData/PhenoGenoMeta.Rds?raw=true"</span>
<span class="kw pkg">repmis</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/repmis/man/source_data.html">source_data</a></span>(<span class="no">githubURL</span>)

<span class="co">## We add a +1 to the SNP data to get values ranging from 1 to 3 as it is required by the particular clustering algorithm the sicomore fucntion use</span>
<span class="no">X2</span> <span class="kw">&lt;-</span> <span class="no">PhenoGenoMeta</span>$<span class="no">Genotype</span> + <span class="fl">1</span>

<span class="co">## We remove the Undefined genera as it not biologically relevant for this analysis. The metagenomic data have been normalized for sequencing depth with TSS transformation.</span>
<span class="no">X1</span> <span class="kw">&lt;-</span> <span class="no">PhenoGenoMeta</span>$<span class="no">Metagenome</span>
<span class="no">X1</span> <span class="kw">&lt;-</span> <span class="no">X1</span>[,-<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">X1</span>) <span class="kw">==</span> <span class="st">"Undefined"</span>)]</pre></body></html></div>
</div>
<div id="material" class="section level2">
<h2 class="hasAnchor">
<a href="#material" class="anchor"></a>Material</h2>
<p>In order to study the interactions between <em>Medicago truncatula</em> and the microbial community of its rhizosphere, a core collection of 154 accessions have been analysed. The purpose of the study is to identify significant interactions between the plant genome and the microbial metagenome to better understand the effect of the microbial community on the growth of the plant.</p>
<p>Each accession were grown in a controlled environment and phenotyped for several traits related to the growth and nutritional strategy:</p>
<ul>
<li>Root Shoot Ratio (RTR)</li>
</ul>
<p>In addition to the phenotypic measurement, the rhizosphere of each accession were also analysed to determine the microbial diversity in terms of number of species and abundance of each species. A total of 848 different species, gathered in 330 genera, were found in the rhizosphere of the plants.</p>
<p>Finally, 154 accession were genotyped with a DNA microarray chip for a total number of 6 372 968 SNPs. The missing values were imputed using the <code>snp.imputation</code> function from the <code>snpStats</code> R package. Given two set of SNPs typed in the same subjects, this function calculates rules which can be used to impute one set from the other in a subsequent sample.</p>
<p>Some SNPs having too many missing values to be imputed at 100%, we only kept the SNPs which have been completely imputed, thus reducing the size of the data to 2 148 505 SNPs.</p>
</div>
<div id="method" class="section level2">
<h2 class="hasAnchor">
<a href="#method" class="anchor"></a>Method</h2>
<p>We focus on the detection of interactions between groups of metagenomic and genetic markers to better understand the complex relationship between environment and genome in the expression of a given phenotype. The proposed method first reduces the dimension of the search space by selecting a subset of super variables in both complementary data sets. The dimension reduction step combines hierarchical clustering, which denes super variables, and Lasso, which selects relevant super variables. Relevant interactions are then explored via linear model testing.</p>
<p>Our algorithm, named SICOMORE for Selection of Interaction effects in COmpressed Multiple Omics REpresentation, can be summarized as follows:</p>
<ol style="list-style-type: decimal">
<li>Reveal the underlying structure of the data with a hierarchical classification.</li>
<li>Compress the data with an aggregation function on each group.</li>
<li>Identify the optimal number of compressed variables by adjusting a model of regression penalised (Lasso, Tibshirani [1994]) weighted with weights denoted by the hierarchical structure.</li>
<li>Test the effects of interactions between each compressed variable selected by the Lasso in a multiple testing procedure.</li>
</ol>
<p><strong>Step 1: Clustering of the data.</strong> In our algorithm, we use an agglomerative hierarchical clustering adapted to omic data [Dehman et al., 2015] in order to reveal the underlying structure but it is possible to use different methods of classication to identify this structure or to use a known structure.</p>
<p><strong>Step 2: Efficient exploration of the hierarchical structure and compression of the data.</strong> Whichever approach is chosen, a systematic exploration of the different levels of the hierarchy is essential to identify an optimal number of groups ([Milligan and Cooper, 1985] or [Gordon, 1999]). We propose a new strategy to bypass this computationaly expensive exploration:</p>
<ol style="list-style-type: lower-alpha">
<li>Extend the entire hierarchical tree by considering all possible groups at all levels.</li>
<li>Assign a weight to each group according to the differences between two groups consecutives in the hierarchy.</li>
<li>Summarize each group into a new compressed variable.</li>
</ol>
<p><strong>Step 3: Selection of the compressed variables.</strong> We assume that the interactions are strong which means that an interaction effect can only be present if the two associated main effects are also significant. A variable selection procedure is therefore used to discard the irrelevant main effects. Here the main effects are defined as the compressed variables constructed in step 2 (iii). We use a l1-penalized regression weighted by the weights defined in step 2 (ii) to select the relevant main effects combined with a stability selection procedure.</p>
<p><strong>Step 4: Identification of interactions.</strong> From a variable selection perspective, the relevant interactions can be identified by considering the interactions between each group selected in the genomic hierachy and each group selected in the metagenomic hierachy in a procedure of multiple tests. We may resort on a Benjamini-Hochberg (BH) correction for multiple testing in order to adjust the p-value in a less conservative way than the bonferroni correction.</p>
</div>
<div id="analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#analysis" class="anchor"></a>Analysis</h2>
<p>The <code><a href="../reference/sicomore.html">sicomore()</a></code> function requires that we choose several hyper-parameters in order to run properly:</p>
<ul>
<li><p>Aggregating function: For the metagenomic and genomic data we define the group average as the supervariable: <code>compression=c("mean","mean")</code></p></li>
<li><p>Clustering algorithm: For the metagenomic we use a hierarchical clustering using Ward’s distance as the measure of similarity. For the genomic data, we used spatially constrained hierarchical clustering algorithm which integrates the linkage disequilibrium as the measure of dissimilarity [Dehman et al., 2015]. It is also possible not to specify any hierarchy for one the 2 datasets, in that case we are looking for interaction between groups of variables in one dataset and single variables in the second dataset: <code>method.clus = c("ward.D2","snpClust")</code></p></li>
<li><p>Search space: For computational reasons, it is possible to restrain the search space in the hierarchy with the <code>depth.cut</code> argument of the function, this argument allows to increase the speed of the algorithm by restraining the search space without affecting too much the performance. A value between 3 and 6 is recommended, the smaller the faster: <code>depth.cut = c(3,5)</code>.</p></li>
<li><p>Stability selection: As the variable selection with Lasso algorithm can be unstable, we proposed to perform a stability selection procedure, using the <code>stabs</code> R package [Benjamin and Hothorn, 2017] with the argument <code>stab = TRUE</code>. The stability parameters for the genomic data have been set to <code>B = 100</code> subsampling replicates with a selection frequency of <code>cutoff = 0.6</code> and a upper bound for the per-family error rate of <code>PFER = 1O</code>. For the metagenomic data, the stability parameters have been set to <code>B = 300</code> subsampling replicates with a selection frequency of <code>cutoff = 0.7</code> and a upper bound for the per-family error rate of <code>PFER = 1O</code>: <code>stab.param = list(B = c(300,100), PFER = c(1,1O), cutoff = c(.7, .6))</code></p></li>
</ul>
<p>We also chose to divide the analysis chromosome by chromosome as running the algorithm on all the SNPs at the same time would require too much memory. We parallelize the process over 8 cores, one for each chromosome.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">123456</span>)
<span class="no">sicomore_RTR</span><span class="kw">&lt;-</span> <span class="kw pkg">parallel</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/mclapply.html">mclapply</a></span>(<span class="fl">1</span>:<span class="fl">8</span>, <span class="kw">function</span>(<span class="no">i</span>){
  <span class="fu"><a href="../reference/sicomore.html">sicomore</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">PhenoGenoMeta</span>$<span class="no">Phenotype</span>$<span class="no">RTR</span>,
           <span class="kw">X.list</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">X1</span>,
                         <span class="no">X2</span>[,<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="no">PhenoGenoMeta</span>$<span class="no">CHR</span> <span class="kw">==</span> <span class="no">i</span>)]),
           <span class="kw">selection</span> <span class="kw">=</span><span class="st">"rho-sicomore"</span>,
           <span class="kw">choice</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"lambda.min"</span>,<span class="st">"lambda.min"</span>),
           <span class="kw">depth.cut</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>,<span class="fl">6</span>),
           <span class="kw">method.clus</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"ward.D2"</span>,<span class="st">"snpClust"</span>),
           <span class="kw">compressions</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"mean"</span>,<span class="st">"mean"</span>),
           <span class="kw">stab</span> <span class="kw">=</span> <span class="no">T</span>,
           <span class="kw">stab.param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">B</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">300</span>,<span class="fl">100</span>), <span class="kw">PFER</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">10</span>), <span class="kw">cutoff</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.7</span>, <span class="fl">.6</span>)))
}, <span class="kw">mc.cores</span> <span class="kw">=</span> <span class="fl">8</span>)</pre></body></html></div>
</div>
<div id="results" class="section level2">
<h2 class="hasAnchor">
<a href="#results" class="anchor"></a>Results</h2>
<p>As the algorithm is computationally heavy, we directly provide the results as an Rdata file hosted on the github repository.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">githubURL</span> <span class="kw">&lt;-</span> <span class="st">"https://github.com/fguinot/MetaRhizo-database/blob/master/rData/sicomore_RTR.Rdata?raw=true"</span>
<span class="kw pkg">repmis</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/repmis/man/source_data.html">source_data</a></span>(<span class="no">githubURL</span>, <span class="kw">rdata</span> <span class="kw">=</span> <span class="no">T</span>)</pre></body></html></div>
<pre><code>## [1] "sicomore.RTR"</code></pre>
<div id="number-of-selected-genomic-groups" class="section level3">
<h3 class="hasAnchor">
<a href="#number-of-selected-genomic-groups" class="anchor"></a>Number of selected genomic groups</h3>
<p>We can look at the number and size of genomic groups selected on each chromosome by the stabilized lasso procedure.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu">map_dfr</span>(<span class="fl">1</span>:<span class="fl">8</span>, <span class="kw">function</span>(<span class="no">i</span>){
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">CHR</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"CHR"</span>,<span class="no">i</span>),
             <span class="kw">Genomic_group</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"X2_comp"</span>,<span class="fl">1</span>:<span class="no">sicomore.RTR</span><span class="kw">[[</span><span class="no">i</span>]]$<span class="no">models</span><span class="kw">[[</span><span class="fl">2</span>]]$<span class="fu">nGrp</span>()),
             <span class="kw">Group_size</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(
               <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="fl">1</span>:<span class="no">sicomore.RTR</span><span class="kw">[[</span><span class="no">i</span>]]$<span class="no">models</span><span class="kw">[[</span><span class="fl">2</span>]]$<span class="fu">nGrp</span>(),
                                      <span class="kw">function</span>(<span class="no">grp</span>)
                                        <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">sicomore.RTR</span><span class="kw">[[</span><span class="no">i</span>]]$<span class="no">models</span><span class="kw">[[</span><span class="fl">2</span>]]$<span class="no">groups</span><span class="kw">[[</span><span class="no">grp</span>]])),<span class="st">"SNPs"</span>)
             )
}) <span class="kw">%&gt;%</span>
  <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">CHR</th>
<th align="left">Genomic_group</th>
<th align="left">Group_size</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">CHR1</td>
<td align="left">X2_comp1</td>
<td align="left">68910 SNPs</td>
</tr>
<tr class="even">
<td align="left">CHR1</td>
<td align="left">X2_comp2</td>
<td align="left">92989 SNPs</td>
</tr>
<tr class="odd">
<td align="left">CHR1</td>
<td align="left">X2_comp3</td>
<td align="left">123627 SNPs</td>
</tr>
<tr class="even">
<td align="left">CHR2</td>
<td align="left">X2_comp1</td>
<td align="left">119753 SNPs</td>
</tr>
<tr class="odd">
<td align="left">CHR2</td>
<td align="left">X2_comp2</td>
<td align="left">97339 SNPs</td>
</tr>
<tr class="even">
<td align="left">CHR2</td>
<td align="left">X2_comp3</td>
<td align="left">33033 SNPs</td>
</tr>
<tr class="odd">
<td align="left">CHR3</td>
<td align="left">X2_comp1</td>
<td align="left">6705 SNPs</td>
</tr>
<tr class="even">
<td align="left">CHR3</td>
<td align="left">X2_comp2</td>
<td align="left">196705 SNPs</td>
</tr>
<tr class="odd">
<td align="left">CHR3</td>
<td align="left">X2_comp3</td>
<td align="left">107528 SNPs</td>
</tr>
<tr class="even">
<td align="left">CHR4</td>
<td align="left">X2_comp1</td>
<td align="left">119947 SNPs</td>
</tr>
<tr class="odd">
<td align="left">CHR4</td>
<td align="left">X2_comp2</td>
<td align="left">197377 SNPs</td>
</tr>
<tr class="even">
<td align="left">CHR5</td>
<td align="left">X2_comp1</td>
<td align="left">38840 SNPs</td>
</tr>
<tr class="odd">
<td align="left">CHR5</td>
<td align="left">X2_comp2</td>
<td align="left">66946 SNPs</td>
</tr>
<tr class="even">
<td align="left">CHR5</td>
<td align="left">X2_comp3</td>
<td align="left">157189 SNPs</td>
</tr>
<tr class="odd">
<td align="left">CHR6</td>
<td align="left">X2_comp1</td>
<td align="left">128557 SNPs</td>
</tr>
<tr class="even">
<td align="left">CHR6</td>
<td align="left">X2_comp2</td>
<td align="left">67369 SNPs</td>
</tr>
<tr class="odd">
<td align="left">CHR6</td>
<td align="left">X2_comp3</td>
<td align="left">6174 SNPs</td>
</tr>
<tr class="even">
<td align="left">CHR7</td>
<td align="left">X2_comp1</td>
<td align="left">136446 SNPs</td>
</tr>
<tr class="odd">
<td align="left">CHR7</td>
<td align="left">X2_comp2</td>
<td align="left">68658 SNPs</td>
</tr>
<tr class="even">
<td align="left">CHR7</td>
<td align="left">X2_comp3</td>
<td align="left">75275 SNPs</td>
</tr>
<tr class="odd">
<td align="left">CHR8</td>
<td align="left">X2_comp1</td>
<td align="left">93142 SNPs</td>
</tr>
<tr class="even">
<td align="left">CHR8</td>
<td align="left">X2_comp2</td>
<td align="left">156827 SNPs</td>
</tr>
</tbody>
</table>
<p>We can see that 2 or 3 groups of genomic variables of varying sizes are selected on each 8 chromosomes.</p>
</div>
<div id="number-of-selected-metagenomic-groups" class="section level3">
<h3 class="hasAnchor">
<a href="#number-of-selected-metagenomic-groups" class="anchor"></a>Number of selected metagenomic groups</h3>
<p>We can look at the number and size of metagenomic groups selected by the stabilized lasso procedure. As the group selection procedure of the metagenomic groups do not depend on the chromosome, we should get the same groups whatever the chromosome.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu">map_dfr</span>(<span class="fl">1</span>:<span class="fl">8</span>, <span class="kw">function</span>(<span class="no">i</span>){
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">CHR</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"CHR"</span>,<span class="no">i</span>),
             <span class="kw">Metagenomic_group</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"X1_comp"</span>,<span class="fl">1</span>:<span class="no">sicomore.RTR</span><span class="kw">[[</span><span class="no">i</span>]]$<span class="no">models</span><span class="kw">[[</span><span class="fl">1</span>]]$<span class="fu">nGrp</span>()),
             <span class="kw">Group_size</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(
               <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="fl">1</span>:<span class="no">sicomore.RTR</span><span class="kw">[[</span><span class="no">i</span>]]$<span class="no">models</span><span class="kw">[[</span><span class="fl">1</span>]]$<span class="fu">nGrp</span>(),
                                      <span class="kw">function</span>(<span class="no">grp</span>)
                                        <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">sicomore.RTR</span><span class="kw">[[</span><span class="no">i</span>]]$<span class="no">models</span><span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">groups</span><span class="kw">[[</span><span class="no">grp</span>]])),<span class="st">"genera"</span>)
             )
}) <span class="kw">%&gt;%</span>
  <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">CHR</th>
<th align="left">Metagenomic_group</th>
<th align="left">Group_size</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">CHR1</td>
<td align="left">X1_comp1</td>
<td align="left">58 genera</td>
</tr>
<tr class="even">
<td align="left">CHR1</td>
<td align="left">X1_comp2</td>
<td align="left">39 genera</td>
</tr>
<tr class="odd">
<td align="left">CHR1</td>
<td align="left">X1_comp3</td>
<td align="left">9 genera</td>
</tr>
<tr class="even">
<td align="left">CHR2</td>
<td align="left">X1_comp1</td>
<td align="left">58 genera</td>
</tr>
<tr class="odd">
<td align="left">CHR2</td>
<td align="left">X1_comp2</td>
<td align="left">39 genera</td>
</tr>
<tr class="even">
<td align="left">CHR2</td>
<td align="left">X1_comp3</td>
<td align="left">9 genera</td>
</tr>
<tr class="odd">
<td align="left">CHR3</td>
<td align="left">X1_comp1</td>
<td align="left">58 genera</td>
</tr>
<tr class="even">
<td align="left">CHR3</td>
<td align="left">X1_comp2</td>
<td align="left">39 genera</td>
</tr>
<tr class="odd">
<td align="left">CHR3</td>
<td align="left">X1_comp3</td>
<td align="left">9 genera</td>
</tr>
<tr class="even">
<td align="left">CHR4</td>
<td align="left">X1_comp1</td>
<td align="left">58 genera</td>
</tr>
<tr class="odd">
<td align="left">CHR4</td>
<td align="left">X1_comp2</td>
<td align="left">39 genera</td>
</tr>
<tr class="even">
<td align="left">CHR4</td>
<td align="left">X1_comp3</td>
<td align="left">9 genera</td>
</tr>
<tr class="odd">
<td align="left">CHR5</td>
<td align="left">X1_comp1</td>
<td align="left">58 genera</td>
</tr>
<tr class="even">
<td align="left">CHR5</td>
<td align="left">X1_comp2</td>
<td align="left">39 genera</td>
</tr>
<tr class="odd">
<td align="left">CHR5</td>
<td align="left">X1_comp3</td>
<td align="left">9 genera</td>
</tr>
<tr class="even">
<td align="left">CHR6</td>
<td align="left">X1_comp1</td>
<td align="left">58 genera</td>
</tr>
<tr class="odd">
<td align="left">CHR6</td>
<td align="left">X1_comp2</td>
<td align="left">39 genera</td>
</tr>
<tr class="even">
<td align="left">CHR6</td>
<td align="left">X1_comp3</td>
<td align="left">9 genera</td>
</tr>
<tr class="odd">
<td align="left">CHR7</td>
<td align="left">X1_comp1</td>
<td align="left">58 genera</td>
</tr>
<tr class="even">
<td align="left">CHR7</td>
<td align="left">X1_comp2</td>
<td align="left">39 genera</td>
</tr>
<tr class="odd">
<td align="left">CHR7</td>
<td align="left">X1_comp3</td>
<td align="left">9 genera</td>
</tr>
<tr class="even">
<td align="left">CHR8</td>
<td align="left">X1_comp1</td>
<td align="left">58 genera</td>
</tr>
<tr class="odd">
<td align="left">CHR8</td>
<td align="left">X1_comp2</td>
<td align="left">39 genera</td>
</tr>
<tr class="even">
<td align="left">CHR8</td>
<td align="left">X1_comp3</td>
<td align="left">9 genera</td>
</tr>
</tbody>
</table>
<p>We can see that the same 3 stable groups of metagenomic variables are selected at each 8 chromosomic iterations showing the stability of the selection procedure.</p>
</div>
<div id="significant-interaction-pval-0-05" class="section level3">
<h3 class="hasAnchor">
<a href="#significant-interaction-pval-0-05" class="anchor"></a>Significant interaction (pval &lt; 0.05)</h3>
<p>We know look at the interactions between the selected supervariblaes by extracting the p-value from the sicomore model. We only look at the interactions with a <span class="math inline">\(p\)</span>-value &lt; 0.05 before FDR-control correction.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co">## get chromosome having interaction with p-value &lt; 0.5</span>
<span class="no">mat.signif</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="fl">1</span>:<span class="fl">8</span>, <span class="kw">function</span>(<span class="no">i</span>) <span class="no">sicomore.RTR</span><span class="kw">[[</span><span class="no">i</span>]]$<span class="no">pval</span> <span class="kw">&lt;</span> <span class="fl">.05</span>)
<span class="no">chr.signif</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">mat.signif</span>, <span class="kw">function</span>(<span class="no">mat</span>) <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span>(<span class="no">mat</span>))))

<span class="co">## Build results dataframe</span>
<span class="no">res.pval</span> <span class="kw">&lt;-</span> <span class="fu">map_dfr</span>(<span class="no">chr.signif</span>, <span class="kw">function</span>(<span class="no">i</span>){
  <span class="no">x</span> <span class="kw">&lt;-</span> <span class="no">sicomore.RTR</span><span class="kw">[[</span><span class="no">i</span>]]
  <span class="no">mat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="no">x</span>$<span class="no">pval</span> <span class="kw">&lt;</span> <span class="fl">.05</span>)
  <span class="co"># SNP &lt;- colnames(X2)[which(PhenoGenoMeta$CHR == i)]</span>
  <span class="co"># region &lt;- sapply(which(apply(mat, 2, any)), </span>
  <span class="co">#                      function(grp) {</span>
  <span class="co">#                        snp &lt;- SNP[x$models[[2]]$groups[grp] %&gt;% unlist]</span>
  <span class="co">#                        paste0(snp[1]," to ",snp[length(snp)], " (",length(snp)," snp)")</span>
  <span class="co">#                      })</span>

  <span class="no">meta.list</span> <span class="kw">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">mat</span>, <span class="fl">1</span>, <span class="no">any</span>)),
                         <span class="kw">function</span>(<span class="no">grp</span>)
                           <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">x</span>$<span class="no">models</span><span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">groups</span>[<span class="no">grp</span>])), <span class="st">"genera"</span>))

  <span class="fu">map_dfr</span>(<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">meta.list</span>) , <span class="kw">function</span>(<span class="no">meta</span>){
    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">CHR</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"CHR"</span>,<span class="no">i</span>),
               <span class="co"># SNP_region = region[colnames(mat)[which(mat[meta,] %&gt;% unlist)]] %&gt;% unlist,</span>
               <span class="kw">OTU_group</span> <span class="kw">=</span> <span class="no">meta.list</span>[<span class="no">meta</span>] <span class="kw">%&gt;%</span> <span class="no">unlist</span>,
               <span class="kw">pvalue</span> <span class="kw">=</span> <span class="no">x</span>$<span class="no">pval</span>[<span class="no">meta</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="no">mat</span>[<span class="no">meta</span>,] <span class="kw">%&gt;%</span> <span class="no">unlist</span> )],
               <span class="kw">qvalue</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html">p.adjust</a></span>(<span class="no">x</span>$<span class="no">pval</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"BH"</span>), <span class="kw">ncol</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="no">x</span>$<span class="no">pval</span>), <span class="kw">dimnames</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(<span class="no">x</span>$<span class="no">pval</span>))[<span class="no">meta</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="no">mat</span>[<span class="no">meta</span>,] <span class="kw">%&gt;%</span> <span class="no">unlist</span>)]
    )
  })
})
<span class="no">res.pval</span> <span class="kw">%&gt;%</span>
  <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">CHR</th>
<th align="left">OTU_group</th>
<th align="right">pvalue</th>
<th align="right">qvalue</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">CHR3</td>
<td align="left">39 genera</td>
<td align="right">0.0286041</td>
<td align="right">0.1771749</td>
</tr>
<tr class="even">
<td align="left">CHR3</td>
<td align="left">39 genera</td>
<td align="right">0.0393722</td>
<td align="right">0.1771749</td>
</tr>
<tr class="odd">
<td align="left">CHR7</td>
<td align="left">39 genera</td>
<td align="right">0.0257538</td>
<td align="right">0.2317842</td>
</tr>
<tr class="even">
<td align="left">CHR8</td>
<td align="left">39 genera</td>
<td align="right">0.0225063</td>
<td align="right">0.1350376</td>
</tr>
</tbody>
</table>
</div>
<div id="list-of-relevant-genera" class="section level3">
<h3 class="hasAnchor">
<a href="#list-of-relevant-genera" class="anchor"></a>List of relevant genera</h3>
<p>We can also extract the 39 genera composing the group have been found in interaction with several genomic regions of the RTR phenotype.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">sicomore.RTR</span><span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">models</span><span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">groups</span><span class="kw">[[</span><span class="fl">2</span>]]</pre></body></html></div>
<pre><code>##    Actinopolymorpha       Aeromicrobium        Algoriphagus       Anderseniella 
##                  12                  14                  16                  28 
##           Aquimonas               Asaia               Bosea      Bradyrhizobium 
##                  31                  37                  54                  55 
##       Brevundimonas Candidatus_Captivus        Chitinophaga       Cryobacterium 
##                  57                  65                  78                  92 
##         Cupriavidus         Deinococcus       Desulfocurvus         Dyadobacter 
##                  93                  97                 102                 113 
##          Glycomyces          Inquilinus      Leptospirillum       Luteolibacter 
##                 143                 162                 172                 174 
##          Lysobacter            Niabella           Niastella            Nocardia 
##                 176                 193                 194                 198 
##         Olivibacter             Pantoea        Patulibacter    Phenylobacterium 
##                 203                 211                 216                 226 
##   Promicromonospora           Rhizobium         Rhodococcus        Ruminococcus 
##                 237                 245                 249                 264 
##      Shuttleworthia        Sphingopyxis         Sporichthya    Syntrophaceticus 
##                 270                 286                 287                 300 
##        Tumebacillus       Undibacterium       Vampirovibrio 
##                 317                 320                 321</code></pre>
</div>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h2>
<p>We can see that the sicomore algorithm was able to find 4 significant interactions (at the threshold of <span class="math inline">\(0.05\)</span> for the non-corrected p-value) from this complex and very larage genomic and metagenomic datasets. The q-value indicates that these interactions do not pass the FDR multiple testing correction but we can argue that it is because we are looking at very small effect. Biological interpretation of these interactions are nonetheless relevant to look at to check if these are not false positives.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Christophe Ambroise, Julien Chiquet, Florent Guinot, Marie Szafranski.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
